!function(t,e){"use strict";e.SingleSegment=e.noWrapSegment.extend({populateFields:function(){var t=this.prepareField(this.params.fields);this.setupField(this.id,t)},prepareField:function(t){var i=0,n=[];return _.each(t,function(o,a){var s=e.cloneObject(t[a]);n[a]=this.prepareFieldData(s,o,i++)}.bind(this)),e.helper.prioritySort(n)},prepareFieldData:function(t){var e=this.params.container;return t.container=this,t.fieldName=e.id+"["+t.fieldName+"]",t},listenFieldChange:function(t,e){this.params.container.listenSegmentChange(this.id,t,e)}}),e.MultiSegment=e.SingleSegment.extend({segmentType:"multi",segmentContentParent:".jkit-condition-content",ready:function(){this.activateSegment()},prepareFieldData:function(t){var e=this.params.index,i=this.params.container;return t.container=this,t.fieldName=i.id+"["+e+"]["+t.fieldName+"]",t},getParentContainer:function(){return this.params.container.container.find(".jkit-condition-wrapper")},attachEvent:function(){this.element.find(".jkit-condition-header").on("click",this.activateSegment.bind(this)),this.element.find(".tab-delete").on("click",this.removeSegment.bind(this))},activateSegment:function(){this.params.parentInstance.activateSegment(this.id)},toogleSegment:function(){setTimeout(function(){this.element.toggleClass("show").find(".jkit-condition-content").slideToggle("fast")}.bind(this),200)},closeSegment:function(){this.element.find(".jkit-condition-content").slideUp("fast")},removeSegment:function(t){t.stopPropagation(),this.element.remove(),this.params.parentInstance.removeSegment(this.id,this.params.index),void 0!==this.params.container.option.parent.saveValue&&this.params.container.option.parent.saveValue()}}),e.segmentConstructor.single=e.SingleSegment,e.segmentConstructor.multi=e.MultiSegment,e.SingleContainer=e.BaseContainer.extend({setContainerHolder:function(){this.containerHolder=this.option.parent.containerHolder},prepareSegmentData:function(t){return t.parent=this.id,t.container=this,t.fields=this.option.fields,t},populateSegments:function(){var t={[this.option.id]:{id:this.option.id,name:this.option.id,type:this.option.type}};t=this.prepareSegment(t),this.setupSegment(this.id,t)},prepareSegment:function(t){return _.each(t,function(i,n){var o=e.cloneObject(t[n]);t[n]=this.prepareSegmentData(o,i)}.bind(this)),e.helper.prioritySort(t)},getValues:function(){var t={};return this.segments(this.option.id).fields.each((function(e){t[e.id]=e.value.get()})),t},listenSegmentChange:function(t,e,i){void 0!==this.option.parent.listenContainerChange&&this.option.parent.listenContainerChange(t,e,i)}}),e.ConditionContainer=e.SingleContainer.extend({initialize:function(t,i,n){this.id=t,this.element=i,this.option=n,this.segments=new e.Values({defaultConstructor:e.Segment}),this.embeed(),this.setContainerHolder(),this.loadContainer()},populateSegments:function(){for(var t in this.option.fields){var e=this.createSegmentParam(t);e=this.prepareSegment(e),this.setupSegment(this.id,e)}},getValues:function(){var t=[];return this.segments.each((function(e){var i={};e.fields.each((function(t){i[t.id]=t.value.get()})),t.push(i)})),t},triggerFinish:function(){this.segments.each(function(t){this.segments(t.id).triggerLoaded()}.bind(this)),this.checkEmptySegment()},prepareSegmentData:function(t,e){return t.parent=this.id,t.container=this,t.parentInstance=this,void 0===this.option.fields?t.fields=this.option.default:t.fields=this.option.fields[e.index],t},activateSegment:function(t){this.segments.each((function(e){t===e.id&&e.toogleSegment()}))},removeSegment:function(t,e){this.segments.remove(t),this.checkEmptySegment()},checkEmptySegment:function(){this.getAllSegments().length?this.hideEmptyCondition():this.renderEmptySegment()},renderEmptySegment:function(){this.element.find(".jkit-condition-empty").show()},hideEmptyCondition:function(){this.element.find(".jkit-condition-empty").hide()},getAllSegments:function(){var t=[];return this.segments.each((function(e){t.push(e.id)})),t},attachEvent:function(){this.container.find(".jkit-condition-add button").on("click",this.buttonAddClicked.bind(this))},buttonAddClicked:function(){this.createMultiSegment(),void 0!==this.option.parent.saveValue&&this.option.parent.saveValue(),this.checkEmptySegment()},createMultiSegment:function(){var t=this.getNextSegmentIndex(),e=this.createSegmentParam(t),i=e.segment.id;(e=this.prepareSegment(e))[0].fields=this.option.default,this.setupSegment(this.id,e),this.segments(i).triggerLoaded(),this.segments(i).activateSegment()},getNextSegmentIndex:function(){var t=0,e=!1;return this.segments.each((function(i){t=i.params.index,e=!0})),e||0!==t?++t:t},createSegmentParam:function(t){var i=e.segmentName(this.option.id,t);return t=parseInt(t),{segment:{id:i,name:this.option.title+" "+(t+1),type:this.option.type,index:t}}},embeed:function(){this.container=t(this.renderContainer()),this.element.append(this.container)},renderContainer:function(){var t=wp.template("jkit-condition-container");return t?t({lang:JKitTemplateConfig.lang}):"<div></div>"}}),e.JKitOptionBuilder=e.Class.extend({initialize:function(t,i,n){this.id=t,this.options=e.cloneObject(i),this.$wrapper=n,this.createContainer()},createContainer:function(){this.containerHolder=new e.Values({defaultConstructor:e.BaseContainer}),_.each(this.options,function(t){t.parent=this,"single"===t.type?this.containerHolder.add(t.id,new e.SingleContainer(t.id,this.$wrapper,t)):this.containerHolder.add(t.id,new e.ConditionContainer(t.id,this.$wrapper,t))}.bind(this))},triggerFinish:function(){this.containerHolder.trigger(this.id,this)}}),e.JKitOptionWrapperBuilder=e.JKitOptionBuilder.extend({initialize:function(t,i,n,o){this.id=t,this.options=e.cloneObject(i),this.$wrapper=n,this.setting=o,this.timeout=null,this.loaded=!1,this.embeed(),this.attachEvent(),Notiflix.Notify.init({position:"right-top",zindex:999999,showOnlyTheLastOne:!0,success:{notiflixIconColor:"#fff"}})},attachEvent:function(){this.$container.find(".jkit-container-header").on("click",this.headerClicked.bind(this)),this.$container.find(".jkit-header-action .tab-delete").on("click",this.deleteClicked.bind(this)),this.$container.find(".jkit-header-action .tab-edit").on("click",this.editClicked.bind(this)),this.$container.find(".jkit-header-action .tab-clone").on("click",this.cloneClicked.bind(this))},editClicked:function(t){t.stopPropagation()},cloneClicked:function(e){e.stopPropagation(),t(e.currentTarget).find("i").attr("class","fas fa-circle-notch fa-spin"),wp.ajax.send("jkit_clone_element",{data:{id:this.id,nonce:JKitTemplateConfig.nonce,type:JKitTemplateConfig.type,page:JKitTemplateConfig.page}}).done(function(t){window.ampdashboard.reRenderWrapper(t)}.bind(this))},deleteClicked:function(i){i.stopPropagation(),confirm(JKitTemplateConfig.lang.deleteelement)&&(t(i.currentTarget).find("i").attr("class","fas fa-circle-notch fa-spin"),wp.ajax.send("jkit_delete_element",{data:{id:this.id,nonce:JKitTemplateConfig.nonce}}).done(function(){this.$container.remove(),e.builderholder.remove(this.id),e.refreshPriority()}.bind(this)))},headerClicked:function(){this.loaded||(this.requestDetail(),this.loaded=!0),this.$container.siblings().each((function(){t(this).removeClass("show").find(".jkit-container-body").slideUp("fast")})),this.$container.toggleClass("show").find(".jkit-container-body").slideToggle("fast")},requestDetail:function(){wp.ajax.send("jkit_detail_element",{data:{id:this.id,nonce:JKitTemplateConfig.nonce,page:JKitTemplateConfig.page}}).done(function(t){this.$container.find(".jkit-container-body").html(""),this.createContainer(t),this.triggerFinish()}.bind(this))},embeed:function(){this.$container=t(this.renderContainer()),this.$wrapper.append(this.$container)},renderContainer:function(){var t=wp.template("jkit-element-container");return t?t({id:this.id,title:this.setting.title,url:this.setting.url,lang:JKitTemplateConfig.lang}):t},createContainer:function(t){this.containerHolder=new e.Values({defaultConstructor:e.BaseContainer});var i=this.$container.find(".jkit-container-body");_.each(this.options,function(n){n.parent=this,n.fields=t[n.id],"single"===n.type?this.containerHolder.add(n.id,new e.SingleContainer(n.id,i,n)):this.containerHolder.add(n.id,new e.ConditionContainer(n.id,i,n))}.bind(this))},listenContainerChange:function(t,e,i){"option"===t&&"title"===e&&this.$container.find(".jkit-container-header h3 span").text(i),this.saveValue()},getValues:function(){var t={};return this.containerHolder.each((function(e){t[e.id]=e.getValues()})),t},saveValue:function(){clearTimeout(this.timeout),this.timeout=setTimeout(function(){wp.ajax.send("jkit_update_element",{data:{id:this.id,data:this.getValues(),nonce:JKitTemplateConfig.nonce}}).done((function(){Notiflix.Notify.success(JKitTemplateConfig.success)}))}.bind(this),500)}})}(jQuery,wp.customize);