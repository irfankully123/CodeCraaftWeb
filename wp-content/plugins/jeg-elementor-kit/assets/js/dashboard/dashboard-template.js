!function(e,t){"use strict";window.ampdashboard={},t.builderholder=new t.Values({defaultConstructor:t.JKitOptionBuilder}),t.JKitPopup=t.Class.extend({loaded:!1,id:"popup",body:e("body"),popupContainer:null,parentContainer:null,initialize:function(t){this.loaded||(this.parentContainer=t,this.createButton=this.parentContainer.find(".create-element-button"),this.createPopupContainer=e(".create-element-builder-wrapper"),this.createPopupOverlay=e(".create-element-builder-overlay"),this.setupPopup(),this.loaded=!0)},setupPopup:function(){this.prepareContainer(),this.attachEvent()},prepareContainer:function(){this.createPopupContainer.append(this.popupContent()),this.popupContainer=e(".popup-content")},containerContent:function(){t.builderholder.add(this.id,new t.JKitOptionBuilder(this.id,this.changeTabToField(),this.popupContainer)),t.builderholder(this.id).triggerFinish()},changeTabToField:function(){var e=[];return _.each(JKitTemplateConfig.tab,(function(t){"single"===t.type&&(t.fields=t.default),e.push(t)})),e},popupContent:function(){var t=wp.template("jkit-popup");return e(t({lang:JKitTemplateConfig.lang}))},renderOption(){this.containerContent(),this.resetPosition()},resetPosition:function(){var t=e(window).height(),i=e(window).width(),n=Math.floor(80*i/100);n=n>600?600:n;var o=Math.floor(80*t/100),a=(i-n)/2,r=(t-(o=o>700?700:o))/2;this.createPopupContainer.css({width:n,height:o,top:r,left:a}),this.createPopupContainer.find(".popup-content").css({height:o-150})},attachEvent:function(){this.createButton.click(this.openCreatePopup.bind(this)),this.createPopupContainer.find(".close").click(this.hideCreatePopup.bind(this)),this.createPopupContainer.find(".generate").click(this.createElement.bind(this)),this.createPopupContainer.draggable({handle:".popup-header"})},attachOpenButton:function(){this.parentContainer.find(".create-element-button").click(this.openCreatePopup.bind(this))},createElement:function(){this.createPopupContainer.find(".generate").text(JKitTemplateConfig.lang.saving),this.ajaxCreateElement().done(function(e){ampdashboard.reRenderWrapper(e),this.hideCreatePopup()}.bind(this))},getValues:function(){var e={};return t.builderholder(this.id).containerHolder.each((function(t){e[t.id]=t.getValues()})),e},ajaxCreateElement:function(){return wp.ajax.send("jkit_create_element",{data:{data:this.getValues(),nonce:JKitTemplateConfig.nonce,type:JKitTemplateConfig.type,page:JKitTemplateConfig.page}})},openCreatePopup:function(){t.builderholder(this.id)&&t.builderholder.remove(this.id),this.popupContainer.html(""),this.resetPosition(),this.body.addClass("overflow-hidden"),this.createPopupContainer.find(".generate").text(JKitTemplateConfig.lang.create),this.createPopupOverlay.fadeIn(),this.createPopupContainer.fadeIn(),this.renderOption()},hideCreatePopup:function(){this.body.removeClass("overflow-hidden"),this.createPopupOverlay.fadeOut(),this.createPopupContainer.fadeOut()}}),t.JKitDashboard=t.Class.extend({empty:"",popupInstance:null,container:e("#jkit-builder-container"),initialize:function(){this.renderWrapper(JKitTemplateConfig.data),this.popupInstance=new t.JKitPopup(this.container),Notiflix.Notify.init({position:"right-top",zindex:999999,showOnlyTheLastOne:!0,success:{notiflixIconColor:"#fff"}})},renderWrapper:function(e){this.container.html(this.empty),this.container.append(this.dashboardContent(e)),this.injectBuilder(e),this.builderSortable(),t.refreshPriority()},reRenderWrapper:function(e){this.renderWrapper(e),this.popupInstance.attachOpenButton()},builderSortable:function(){e("#active-element, #inactive-element").sortable({connectWith:".connectedSortable",cursor:"move",cancel:".selectize-control, .widefat",stop:function(){var i=[];e(".active-element-wrapper .jkit-element-container").each((function(t){i.push(e(this).data("id"))}));var n=[];e(".inactive-element-wrapper .jkit-element-container").each((function(){n.push(e(this).data("id"))})),this.saveSortable(i,n),t.refreshPriority()}.bind(this)}).disableSelection()},saveSortable:function(e,t){clearTimeout(this.sortableTimeout),this.sortableTimeout=setTimeout(function(){wp.ajax.send("jkit_update_sequence",{data:{id:this.id,publish:e,draft:t,nonce:JKitTemplateConfig.nonce}}).done((function(){Notiflix.Notify.success(JKitTemplateConfig.success)}))}.bind(this),500)},injectBuilder:function(t){this.removeBuilderHolder(),this.buildOption(t.publish,e(".active-element-wrapper .content-body")),this.buildOption(t.draft,e(".inactive-element-wrapper .content-body")),window.dispatchEvent(new Event("resize"))},buildOption:function(e,i){e.forEach(function(e){var n=e.id.toString(),o=this.mergeValues(JKitTemplateConfig.tab,e);t.builderholder.add(n,new t.JKitOptionWrapperBuilder(n,o,i,e))}.bind(this))},mergeValues:function(e,i){var n=[];return t.cloneObject(e).forEach((function(e){e.values=i[e.id],n.push(e)})),n},removeBuilderHolder:function(){t.builderholder.each((function(e){t.builderholder.remove(e.id)}))},dashboardContent:function(t){var i=null;return i=0===t.publish.length&&0===t.draft.length?wp.template("jkit-builder-empty"):wp.template("jkit-builder-content"),e(i({lang:JKitTemplateConfig.lang}))},getValues:function(){t.builderholder.each((function(e){var t=[];e.containerHolder.each((function(e){t[e.id]=e.getValues()}))}))}}),t.cloneObject=function(e){return JSON.parse(JSON.stringify(e))},t.segmentName=function(e,t){return e+"_"+t},t.refreshPriority=function(){e(".active-element-wrapper .jkit-container-header").each((function(t){e(this).find(".tab-priority").text(t+1)}))},e(document).ready((function(){window.ampdashboard=new t.JKitDashboard}))}(jQuery,wp.customize);